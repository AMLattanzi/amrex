#!/bin/ksh
#
# Prefix's for chk and plt files.
#
chk_prefix=chk
plt_prefix=plt
#
# Number of seconds to sleep before checking again.
#
N=60
#
# Tar up and then remove plt and chk directories.
#
function tar_up_and_rm_files
{
  #
  # Take all but the final chk file -- want job chaining to work.
  #
  chklist=$(ls -d ${chk_prefix}* 2>/dev/null)

  if [ "$chklist" ]
  then
    nl=$(echo "$chklist" | wc -l)
    nl=$(expr $nl - 1)
    if [ $nl -eq 0 ]
    then
      chklist=""
    else
      chklist=$(echo "$chklist" | head -$nl)
    fi
  fi
  #
  # Take all the plt files.
  #
  pltlist=$(ls -d ${plt_prefix}* 2>/dev/null)

  list="$chklist $pltlist"

  for dir in ${list}
  do
    if [ -d ${dir} ]
    then
      #
      # If the Header is non-zero sized the chk or plt file is complete.
      # This relies on the Header being the last file written to disk.
      #
      if [ -s ${dir}/Header ]
      then
        if `tar cf ${dir}.tar ${dir}`
        then
          rm -rf ${dir}
        fi
      fi
    fi
  done
}
#
# Looping waiting for plt and chk directories to appear.
#
while true
do
  tar_up_and_rm_files
  sleep $N
done

